"use strict";exports.id=7092,exports.ids=[7092],exports.modules={47092:(e,t,r)=>{r.d(t,{U:()=>s});var a=r(2777);class i{async getChildren(e){try{console.log("Fetching children for parent:",e);let{data:t,error:r}=await a.supabase.from("students").select(`
          id,
          user_id,
          parent_id,
          full_name,
          grade_level,
          date_of_birth,
          avatar_url,
          bio
        `).eq("parent_id",e);if(r)throw console.error("Students query error:",r),r;if(console.log("Found students:",t),!t||0===t.length)return[];let i=[];for(let e of t)try{let t=e.full_name||"Unknown",r=e.avatar_url;if(!e.full_name){let{data:i,error:s}=await a.supabase.from("users").select("full_name, avatar_url").eq("id",e.user_id).single();if(!s&&i)t=i.full_name||"Unknown",r=e.avatar_url||i.avatar_url,console.log("Found name from users table:",t);else{let{data:r}=await a.supabase.auth.admin.getUserById(e.user_id);r.user?.email&&(t="Student "+r.user.email.split("@")[0],console.log("Created name from email:",t))}}i.push({id:e.id,name:t,user_id:e.user_id,grade_level:e.grade_level?.toString()||"",date_of_birth:e.date_of_birth||"",avatar_url:r,progress:this.calculateProgress(e.id),subjects:["Mathematics","Science","English"],next_lesson:this.getNextLesson(e.id)}),console.log("Processed child:",t,"with avatar:",r)}catch(t){console.error("Error processing student:",e.id,t),i.push({id:e.id,name:e.full_name||"Unknown",user_id:e.user_id,grade_level:e.grade_level?.toString()||"",date_of_birth:e.date_of_birth||"",avatar_url:e.avatar_url,progress:this.calculateProgress(e.id),subjects:["Mathematics","Science","English"],next_lesson:this.getNextLesson(e.id)})}return i}catch(e){return console.error("Error fetching children:",e),[]}}async updateChild(e,t){try{let{data:r,error:i}=await a.supabase.from("students").update({full_name:t.name,grade_level:t.grade_level,date_of_birth:t.date_of_birth,avatar_url:t.avatar_url,bio:t.bio}).eq("id",e).select().single();if(i)throw Error(`Database error: ${i.message}`);if(t.name||t.avatar_url){let{data:r}=await a.supabase.from("students").select("user_id").eq("id",e).single();if(r?.user_id){let{error:e}=await a.supabase.from("users").update({full_name:t.name,avatar_url:t.avatar_url}).eq("id",r.user_id);e&&console.error("Failed to update user profile:",e)}}return r}catch(e){throw console.error("Error updating child:",e),e}}async deleteChild(e){try{let{data:t}=await a.supabase.from("students").select("user_id").eq("id",e).single(),{error:r}=await a.supabase.from("students").delete().eq("id",e);if(r)throw Error(`Database error: ${r.message}`);if(t?.user_id){let{error:e}=await a.supabase.from("users").delete().eq("id",t.user_id);e&&console.error("Failed to delete user profile:",e)}return!0}catch(e){throw console.error("Error deleting child:",e),e}}async addChild(e,t){try{let{data:r,error:i}=await a.supabase.auth.signUp({email:t.email,password:t.password});if(i)throw Error(`Authentication error: ${i.message}`);if(!r.user)throw Error("Failed to create user account - no user data returned");console.log("Creating user profile with name:",t.name);let{data:s,error:n}=await a.supabase.from("users").insert([{id:r.user.id,full_name:t.name,avatar_url:t.avatar_url,role:"student",created_at:new Date().toISOString()}]).select().single();if(n){console.error("Profile creation error:",n);let{error:e}=await a.supabase.from("users").update({full_name:t.name,avatar_url:t.avatar_url,role:"student"}).eq("id",r.user.id);if(e)throw console.error("Profile update error:",e),Error(`Failed to create/update user profile: ${e.message}`);console.log("Profile updated successfully")}else console.log("Profile created successfully:",s);let{data:o,error:c}=await a.supabase.from("students").insert([{user_id:r.user.id,parent_id:e,full_name:t.name,grade_level:t.grade_level,date_of_birth:t.date_of_birth,avatar_url:t.avatar_url}]).select().single();if(c)throw Error(`Database error: ${c.message}`);return o}catch(e){throw console.error("Error adding child:",e),e}}calculateProgress(e){return Math.floor(30*Math.random())+70}getNextLesson(e){return"Today, 3:00 PM - Math with Ms. Chen"}async getRecentActivities(e){try{return[{id:"1",student_name:"Sarah",activity:"\uD83D\uDCDA Completed Math Assignment",time:"2 hours ago",type:"success",icon:"✅"},{id:"2",student_name:"Tom",activity:"\uD83D\uDD2C Science Lesson Scheduled",time:"4 hours ago",type:"info",icon:"\uD83D\uDCC5"},{id:"3",student_name:"Sarah",activity:"\uD83D\uDCB3 Payment Processed",time:"1 day ago",type:"warning",icon:"\uD83D\uDCB0"},{id:"4",student_name:"Tom",activity:"\uD83D\uDCCA Progress Report Available",time:"2 days ago",type:"success",icon:"\uD83C\uDF89"}]}catch(e){return console.error("Error fetching activities:",e),[]}}async getAchievements(e){try{return[{id:"1",title:"Math Master",icon:"\uD83C\uDFC6",description:"Complete 10 math lessons",earned:!0},{id:"2",title:"Science Explorer",icon:"\uD83D\uDD2C",description:"Finish science module",earned:!0},{id:"3",title:"Reading Champion",icon:"\uD83D\uDCD6",description:"Read 5 books",earned:!1}]}catch(e){return console.error("Error fetching achievements:",e),[]}}async getUpcomingLessons(e){try{return[{id:"1",student_name:"Sarah Johnson",subject:"Mathematics",tutor_name:"Ms. Chen",time:"Today, 3:00 PM",duration:"60 min",status:"scheduled"},{id:"2",student_name:"Tom Johnson",subject:"Science",tutor_name:"Dr. Smith",time:"Tomorrow, 4:30 PM",duration:"45 min",status:"scheduled"}]}catch(e){return console.error("Error fetching lessons:",e),[]}}async getPaymentHistory(e){try{return[{id:"1",amount:120,description:"Math Lessons - Sarah",status:"completed",due_date:"2024-11-10",paid_at:"2024-11-09"},{id:"2",amount:80,description:"Science Lessons - Tom",status:"pending",due_date:"2024-11-15"}]}catch(e){return console.error("Error fetching payments:",e),[]}}async getActivityTypes(){try{let{data:e,error:t}=await a.supabase.from("activity_types").select("*").eq("is_active",!0).order("category",{ascending:!0});if(t)throw t;if(!e||0===e.length)return this.getDefaultActivityTypes();return e}catch(e){return console.error("Error fetching activity types:",e),this.getDefaultActivityTypes()}}getDefaultActivityTypes(){return[{id:"1",name:"Tuition Class",category:"academic",icon:"\uD83D\uDCDA",default_duration:60,color:"#3B82F6",description:"Private or group tuition sessions",is_active:!0},{id:"2",name:"Homework Time",category:"academic",icon:"✏️",default_duration:45,color:"#10B981",description:"Dedicated time for homework and assignments",is_active:!0},{id:"3",name:"Reading",category:"academic",icon:"\uD83D\uDCD6",default_duration:30,color:"#8B5CF6",description:"Reading books and literature",is_active:!0},{id:"4",name:"Math Practice",category:"academic",icon:"\uD83D\uDD22",default_duration:45,color:"#F59E0B",description:"Mathematics practice and problem solving",is_active:!0},{id:"5",name:"Science Lab",category:"academic",icon:"\uD83D\uDD2C",default_duration:60,color:"#EF4444",description:"Science experiments and practical work",is_active:!0},{id:"6",name:"Sports",category:"extracurricular",icon:"⚽",default_duration:60,color:"#10B981",description:"Physical activities and sports",is_active:!0},{id:"7",name:"Music Practice",category:"extracurricular",icon:"\uD83C\uDFB5",default_duration:30,color:"#EC4899",description:"Musical instrument practice",is_active:!0},{id:"8",name:"Art & Craft",category:"extracurricular",icon:"\uD83C\uDFA8",default_duration:45,color:"#F97316",description:"Creative arts and crafts",is_active:!0},{id:"9",name:"Meal Time",category:"personal",icon:"\uD83C\uDF7D️",default_duration:30,color:"#84CC16",description:"Breakfast, lunch, or dinner",is_active:!0},{id:"10",name:"Free Play",category:"personal",icon:"\uD83C\uDFAE",default_duration:60,color:"#06B6D4",description:"Unstructured play and recreation",is_active:!0},{id:"11",name:"Screen Time",category:"personal",icon:"\uD83D\uDCF1",default_duration:30,color:"#6366F1",description:"Educational or entertainment screen time",is_active:!0},{id:"12",name:"Exercise",category:"health",icon:"\uD83D\uDCAA",default_duration:30,color:"#059669",description:"Physical exercise and fitness",is_active:!0},{id:"13",name:"Meditation",category:"health",icon:"\uD83E\uDDD8",default_duration:15,color:"#7C3AED",description:"Mindfulness and meditation",is_active:!0},{id:"14",name:"Sleep",category:"health",icon:"\uD83D\uDE34",default_duration:480,color:"#1F2937",description:"Bedtime and sleep",is_active:!0},{id:"15",name:"Family Time",category:"social",icon:"\uD83D\uDC68‍\uD83D\uDC69‍\uD83D\uDC67‍\uD83D\uDC66",default_duration:60,color:"#DC2626",description:"Quality time with family",is_active:!0},{id:"16",name:"Playdate",category:"social",icon:"\uD83D\uDC6B",default_duration:120,color:"#7C2D12",description:"Social interaction with friends",is_active:!0}]}async getChildSchedule(e,t,r){try{let{data:i,error:s}=await a.supabase.from("schedule_activities").select(`
          *,
          activity_type:activity_types(*)
        `).eq("child_id",e).gte("date",t).lte("date",r).order("date",{ascending:!0}).order("start_time",{ascending:!0});if(s){console.log("schedule_activities table not found, using sessions table as fallback");let{data:i,error:s}=await a.supabase.from("sessions").select("*").eq("student_id",e).gte("scheduled_time",`${t}T00:00:00Z`).lte("scheduled_time",`${r}T23:59:59Z`).order("scheduled_time",{ascending:!0});if(s)throw s;return(i||[]).map(e=>{let t=e.scheduled_time.split("T")[0],r=e.scheduled_time.split("T")[1].split(":").slice(0,2).join(":"),[a,i]=r.split(":").map(Number),s=60*a+i+(e.duration_minutes||60),n=`${Math.floor(s/60).toString().padStart(2,"0")}:${(s%60).toString().padStart(2,"0")}`;return{id:e.id,child_id:e.student_id,child_name:"",title:e.notes||e.subject||"Activity",description:e.notes,activity_type:e.subject||"custom",subject:e.subject,date:t,start_time:r,end_time:n,duration:e.duration_minutes||60,location:null,status:e.status||"scheduled",priority:"medium",is_recurring:!1,recurrence_pattern:null,reminders:null,notes:e.notes,color:"#106EBE",created_at:e.created_at,updated_at:e.updated_at}})}return this.formatScheduleActivities(i||[])}catch(e){return console.error("Error fetching child schedule:",e),[]}}async getFamilySchedule(e,t,r){try{let i=await this.getChildren(e);if(0===i.length)return[];let s=i.map(e=>e.id),{data:n,error:o}=await a.supabase.from("schedule_activities").select(`
          *,
          activity_type:activity_types(*)
        `).in("child_id",s).gte("date",t).lte("date",r).order("date",{ascending:!0}).order("start_time",{ascending:!0});if(o){console.log("schedule_activities table not found, using sessions table as fallback");let{data:e,error:n}=await a.supabase.from("sessions").select("*").in("student_id",s).gte("scheduled_time",`${t}T00:00:00Z`).lte("scheduled_time",`${r}T23:59:59Z`).order("scheduled_time",{ascending:!0});if(n)throw n;return(e||[]).map(e=>{let t=e.scheduled_time.split("T")[0],r=e.scheduled_time.split("T")[1].split(":").slice(0,2).join(":"),a=i.find(t=>t.id===e.student_id),[s,n]=r.split(":").map(Number),o=60*s+n+(e.duration_minutes||60),c=`${Math.floor(o/60).toString().padStart(2,"0")}:${(o%60).toString().padStart(2,"0")}`;return{id:e.id,child_id:e.student_id,child_name:a?.name||"Unknown",title:e.notes||e.subject||"Activity",description:e.notes,activity_type:e.subject||"custom",subject:e.subject,date:t,start_time:r,end_time:c,duration:e.duration_minutes||60,location:null,status:e.status||"scheduled",priority:"medium",is_recurring:!1,recurrence_pattern:null,reminders:null,notes:e.notes,color:"#106EBE",created_at:e.created_at,updated_at:e.updated_at}})}return this.formatScheduleActivities(n||[])}catch(e){return console.error("Error fetching family schedule:",e),[]}}formatScheduleActivities(e){return e.map(e=>({id:e.id,child_id:e.child_id,child_name:e.child_name||"Unknown",title:e.title,description:e.description,activity_type:e.activity_type||this.getDefaultActivityTypes()[0],start_time:e.start_time,end_time:e.end_time,date:e.date,is_recurring:e.is_recurring,recurrence_pattern:e.recurrence_pattern,location:e.location,tutor_id:e.tutor_id,tutor_name:e.tutor_name,is_completed:e.is_completed,priority:e.priority||"medium",color:e.color,reminders:e.reminders||[],attachments:e.attachments||[],notes:e.notes,created_at:e.created_at,updated_at:e.updated_at}))}async createScheduleActivity(e){try{let{data:t,error:r}=await a.supabase.from("schedule_activities").insert([{...e,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(r){console.log("schedule_activities table not found, using sessions table as fallback");let t={student_id:e.child_id,subject:e.subject||e.activity_type,tutor_id:null,scheduled_time:`${e.date}T${e.start_time}:00Z`,duration_minutes:e.duration||60,status:e.status||"scheduled",notes:e.description||e.title,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:r,error:i}=await a.supabase.from("sessions").insert([t]).select().single();if(i)throw i;return{id:r.id,child_id:r.student_id,child_name:e.child_name,title:e.title,description:e.description,activity_type:e.activity_type,subject:r.subject,date:e.date,start_time:e.start_time,end_time:e.end_time,duration:r.duration_minutes,location:e.location,status:r.status,priority:e.priority,is_recurring:e.is_recurring,recurrence_pattern:e.recurrence_pattern,reminders:e.reminders,notes:r.notes,color:e.color,created_at:r.created_at,updated_at:r.updated_at}}return this.formatScheduleActivities([t])[0]}catch(e){throw console.error("Error creating schedule activity:",e),e}}async updateScheduleActivity(e,t){try{let{data:r,error:i}=await a.supabase.from("schedule_activities").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return this.formatScheduleActivities([r])[0]}catch(e){throw console.error("Error updating schedule activity:",e),e}}async deleteScheduleActivity(e){try{let{error:t}=await a.supabase.from("schedule_activities").delete().eq("id",e);if(t)throw t;return!0}catch(e){throw console.error("Error deleting schedule activity:",e),e}}async createRecurringActivity(e){if(!e.is_recurring||!e.recurrence_pattern)throw Error("Activity must be recurring with a valid pattern");let t=[],{type:r,interval:i,days_of_week:s,end_date:n,end_occurrences:o}=e.recurrence_pattern,c=new Date(e.date),l=0,d=o||100;for(;l<d&&!(n&&c>new Date(n))&&(!o||!(l>=o));){if(this.doesDateMatchPattern(c,e.recurrence_pattern)){let r={...e,date:c.toISOString().split("T")[0],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};t.push(r),l++}c=this.getNextRecurrenceDate(c,e.recurrence_pattern)}try{let{data:e,error:r}=await a.supabase.from("schedule_activities").insert(t).select();if(r)throw r;return this.formatScheduleActivities(e||[])}catch(e){throw console.error("Error creating recurring activities:",e),e}}doesDateMatchPattern(e,t){switch(t.type){case"daily":return!0;case"weekly":return t.days_of_week?.includes(e.getDay())??!0;case"monthly":return e.getDate()===(t.day_of_month||e.getDate());case"yearly":return e.getDate()===new Date(t.end_date||"").getDate()&&e.getMonth()===new Date(t.end_date||"").getMonth();default:return!1}}getNextRecurrenceDate(e,t){let r=new Date(e);switch(t.type){case"daily":r.setDate(r.getDate()+(t.interval||1));break;case"weekly":r.setDate(r.getDate()+7*(t.interval||1));break;case"monthly":r.setMonth(r.getMonth()+(t.interval||1));break;case"yearly":r.setFullYear(r.getFullYear()+(t.interval||1))}return r}async scheduleLesson(e){try{let{data:t,error:r}=await a.supabase.from("sessions").insert([{...e,status:"scheduled"}]).select();if(r)throw r;return t}catch(e){throw console.error("Error scheduling lesson:",e),e}}async sendMessage(e){try{let{data:t,error:r}=await a.supabase.from("messages").insert([e]).select();if(r)throw r;return t}catch(e){throw console.error("Error sending message:",e),e}}async getDashboardStats(e){try{return{activeLessons:12,childrenEnrolled:2,totalSpent:1240,upcomingSessions:5}}catch(e){return console.error("Error fetching dashboard stats:",e),{activeLessons:0,childrenEnrolled:0,totalSpent:0,upcomingSessions:0}}}async getScheduleStatistics(e){try{let t=new Date,r=new Date(t);r.setDate(t.getDate()-t.getDay()),r.setHours(0,0,0,0);let a=new Date(r);a.setDate(r.getDate()+6),a.setHours(23,59,59,999);let i=t.toISOString().split("T")[0],s=new Date(t.getTime()+864e5).toISOString().split("T")[0],n=await this.getFamilySchedule(e,r.toISOString().split("T")[0],s),o=n.length,c=n.filter(e=>{let t=new Date(e.date);return t>=r&&t<=a}).length,l=n.filter(e=>e.date>=i&&"lesson"===e.activity_type&&"scheduled"===e.status).length,d=n.filter(e=>e.date===i&&"completed"===e.status).length;return{totalActivities:o,thisWeek:c,upcomingLessons:l,completedToday:d}}catch(e){return console.error("Error getting schedule statistics:",e),{totalActivities:0,thisWeek:0,upcomingLessons:0,completedToday:0}}}async getLearningInsights(e){try{let t=new Date,r=new Date(t);r.setDate(t.getDate()-t.getDay()),r.setHours(0,0,0,0);let a=new Date(r);a.setDate(r.getDate()+6),a.setHours(23,59,59,999);let i=await this.getFamilySchedule(e,r.toISOString().split("T")[0],a.toISOString().split("T")[0]),s={};i.forEach(e=>{let t=e.subject||"General";s[t]=(s[t]||0)+1});let n=Object.keys(s).reduce((e,t)=>s[e]>s[t]?e:t,Object.keys(s)[0]||"Mathematics"),o=i.length,c=o>0?Math.min(100,s[n]/o*100):0,l=i.reduce((e,t)=>{let r=t.duration||60;return e+r},0),d=Math.round(l/60),u="Keep up the great work!",h=Object.keys(s);if(1===h.length)u="Consider adding activities in different subject areas for a balanced approach";else if(d<15)u=`Try to add ${15-d} more hours of activities this week`;else if(c>80){let e=h.filter(e=>e!==n);e.length>0&&(u=`Great progress in ${n}! Consider exploring more ${e[0]} activities`)}return{mostActiveSubject:n,mostActiveSubjectProgress:Math.round(c),weeklyGoalProgress:{current:d,target:15},recommendation:u}}catch(e){return console.error("Error getting learning insights:",e),{mostActiveSubject:"Mathematics",mostActiveSubjectProgress:0,weeklyGoalProgress:{current:0,target:15},recommendation:"Start adding activities to see personalized insights"}}}async getChildProgress(e){try{let t=await assignmentService.getChildAssignments(e),r=t.filter(e=>"reviewed"===e.status&&null!==e.score),a=r.length>0?r.reduce((e,t)=>e+(t.score||0),0)/r.length:0,i=new Date,s=new Date(i.getTime()-2592e6),n=await this.getChildSchedule(e,s.toISOString().split("T")[0],i.toISOString().split("T")[0]),o=n.filter(e=>"completed"===e.status),c=n.length>0?o.length/n.length*100:0,l={},d={};r.forEach(e=>{null!==e.score&&(d[e.subject]||(d[e.subject]=[]),d[e.subject].push(e.score))}),Object.keys(d).forEach(e=>{let t=d[e];l[e]=Math.round(t.reduce((e,t)=>e+t,0)/t.length)});let u={};n.forEach(e=>{let t=e.subject||"General";u[t]=(u[t]||0)+1});let h=Object.keys(u).reduce((e,t)=>u[e]>u[t]?e:t,Object.keys(u)[0]||"Mathematics"),_=r.slice(-10),g=r.slice(-20,-10),m=_.length>0?_.reduce((e,t)=>e+(t.score||0),0)/_.length:0,p=g.length>0?g.reduce((e,t)=>e+(t.score||0),0)/g.length:0,y="stable",f=0;_.length>=5&&g.length>=5&&((f=Math.round(m-p))>5?y="improving":f<-5&&(y="declining"));let D=Math.round(Math.min(100,a/100*60)+Math.min(100,.4*c)),v="Keep up the great work!";return v=D>=90?"Excellent! Consider advanced topics.":D>=80?"Great progress! Aim for 90% consistency.":D>=70?"Good work! Focus on completing all activities.":D>=60?"Keep improving! Submit assignments on time.":"Focus on completing daily activities and assignments.",{overall_progress:D,subject_progress:l,assignment_stats:{total:t.length,completed:r.length,average_score:Math.round(a),pending:t.filter(e=>["assigned","in_progress"].includes(e.status)).length},activity_stats:{total_activities:n.length,completed_activities:o.length,attendance_rate:Math.round(c),most_active_subject:h},recent_performance:{trend:y,score_change:f},next_milestone:v}}catch(e){return console.error("Error calculating child progress:",e),{overall_progress:0,subject_progress:{},assignment_stats:{total:0,completed:0,average_score:0,pending:0},activity_stats:{total_activities:0,completed_activities:0,attendance_rate:0,most_active_subject:"Mathematics"},recent_performance:{trend:"stable",score_change:0},next_milestone:"Start engaging in activities to see progress"}}}}let s=new i}};