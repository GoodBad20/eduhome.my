<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google OAuth Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Google OAuth Test for EduHome.my</h1>
    <p>This page tests the Google OAuth implementation.</p>

    <div id="status">
        <p>Loading Supabase client...</p>
    </div>

    <div id="auth-section">
        <button onclick="testGoogleSignIn()">Test Google Sign-In</button>
        <button onclick="testSupabaseConnection()">Test Supabase Connection</button>
        <button onclick="checkAuthProvider()">Check Auth Provider</button>
    </div>

    <div id="results">
        <h3>Results:</h3>
        <pre id="output"></pre>
    </div>

    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://o2ys9gbq3-wvjatzwgmcn.supabase.co'; // From your environment
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im8yeXM5Z2JxMy13dmphdHp3Z21jbiIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzM2OTY1MTc3LCJleHAiOjIwNTI1NDE3Nzd9.7a5S2LWW2Q_twr9l9p3NvBWU5JY-lhQKKnRZUkz4RpY'; // From your environment

        let supabase;

        try {
            supabase = createClient(supabaseUrl, supabaseAnonKey);
            log('‚úÖ Supabase client initialized successfully');
            log('Available auth methods: ' + Object.getOwnPropertyNames(supabase.auth).filter(name => typeof supabase.auth[name] === 'function'));
        } catch (error) {
            log('‚ùå Failed to initialize Supabase client: ' + error.message);
        }

        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        async function testSupabaseConnection() {
            log('üîÑ Testing Supabase connection...');
            try {
                const { data, error } = await supabase.from('user_settings').select('count');
                if (error) {
                    log('‚ùå Supabase connection error: ' + error.message);
                } else {
                    log('‚úÖ Supabase connection successful');
                }
            } catch (error) {
                log('‚ùå Supabase test failed: ' + error.message);
            }
        }

        async function checkAuthProvider() {
            log('üîÑ Checking OAuth provider availability...');
            if (supabase && supabase.auth && typeof supabase.auth.signInWithOAuth === 'function') {
                log('‚úÖ signInWithOAuth method is available');
                log('‚úÖ Google OAuth implementation is ready');
            } else {
                log('‚ùå signInWithOAuth method not available');
                log('‚ùå Supabase client may not be properly configured');
            }
        }

        async function testGoogleSignIn() {
            log('üîÑ Testing Google OAuth sign-in...');
            if (!supabase || !supabase.auth) {
                log('‚ùå Supabase client not initialized');
                return;
            }

            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + '/dashboard'
                    }
                });

                if (error) {
                    log('‚ùå Google OAuth error: ' + error.message);
                    log('‚ùå This usually means Google provider is not configured in Supabase');
                } else {
                    log('‚úÖ Google OAuth initiated successfully');
                    log('üìù Check the setup documentation for Google Cloud Console configuration');
                    log('üìù Once configured, this will redirect to Google sign-in');
                }
            } catch (error) {
                log('‚ùå Google OAuth test failed: ' + error.message);
            }
        }

        // Auto-run checks
        window.onload = function() {
            checkAuthProvider();
        };
    </script>

    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        button { margin: 10px; padding: 10px 20px; background: #106EBE; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0a89cc; }
        #output { background: #f5f5f5; padding: 10px; border-radius: 4px; white-space: pre-wrap; }
        .status { margin: 10px 0; }
    </style>
</body>
</html>